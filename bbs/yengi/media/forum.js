function saveData(ignoreempty){var ignoreempty=isUndefined(ignoreempty)?0:ignoreempty,obj=$("postform")&&($("fwin_newthread")&&""==$("fwin_newthread").style.display||$("fwin_reply")&&""==$("fwin_reply").style.display)?$("postform"):$("fastpostform")?$("fastpostform"):$("postform");if(obj){if("undefined"!=typeof isfirstpost){if("undefined"!=typeof wysiwyg&&1==wysiwyg)var messageisnull=""===trim(html2bbcode(editdoc.body.innerHTML));else var messageisnull=""===$("postform").message.value;if(isfirstpost&&messageisnull&&""===$("postform").subject.value)return;if(!isfirstpost&&messageisnull)return}for(var data=subject=message="",i=0;obj.elements.length>i;i++){var el=obj.elements[i];if(""!=el.name&&("SELECT"==el.tagName||"TEXTAREA"==el.tagName||"INPUT"==el.tagName&&("text"==el.type||"checkbox"==el.type||"radio"==el.type||"hidden"==el.type||"select"==el.type))&&"attach"!=el.name.substr(0,6)){var elvalue=el.value;if("subject"==el.name?subject=trim(elvalue):"message"==el.name&&("undefined"!=typeof wysiwyg&&1==wysiwyg&&(elvalue=html2bbcode(editdoc.body.innerHTML)),message=trim(elvalue)),!("checkbox"!=el.type&&"radio"!=el.type||el.checked))continue;if("SELECT"==el.tagName)elvalue=el.value;else if("hidden"==el.type){if(!el.id)continue;if(eval("var check = typeof "+el.id+"_upload == 'function'"),!check)continue;elvalue=elvalue,$(el.id+"_url")&&(elvalue+=String.fromCharCode(1)+$(el.id+"_url").value)}trim(elvalue)&&(data+=el.name+String.fromCharCode(9)+el.tagName+String.fromCharCode(9)+el.type+String.fromCharCode(9)+elvalue+String.fromCharCode(9,9))}}(subject||message||ignoreempty)&&saveUserdata("forum_"+discuz_uid,data)}}function fastUload(){appendscript(JSPATH+"forum_post.js?"+VERHASH),safescript("forum_post_js",function(){uploadWindow(function(e,t){updatefastpostattach(e,t)},"file")},100,50)}function switchAdvanceMode(e){var t=$("postform")&&($("fwin_newthread")&&""==$("fwin_newthread").style.display||$("fwin_reply")&&""==$("fwin_reply").style.display)?$("postform"):$("fastpostform");return t&&""!=t.message.value&&(saveData(),e+=(-1!=e.indexOf("?")?"&":"?")+"cedit=yes"),location.href=e,!1}function sidebar_collapse(e){if(e[0])toggle_collapse("sidebar",null,null,e),$("wrap").className="wrap with_side s_clear"==$("wrap").className?"wrap s_clear":"wrap with_side s_clear";else{var t=getcookie("collapse");t=updatestring(t,"sidebar",1),setcookie("collapse",t,t?2592e3:-2592e3),location.reload()}}function keyPageScroll(e,t,i,n,a){if(loadUserdata("is_blindman"))return!0;e=e?e:window.event;var s=BROWSER.ie?e.srcElement.tagName:e.target.tagName;"INPUT"!=s&&"TEXTAREA"!=s&&(actualCode=e.keyCode?e.keyCode:e.charCode,i&&39==actualCode&&(window.location=n+"&page="+(a+1)),t&&37==actualCode&&(window.location=n+"&page="+(a-1)))}function announcement(){var e={};e.anndelay=3e3,e.annst=0,e.annstop=0,e.annrowcount=0,e.anncount=0,e.annlis=$("anc").getElementsByTagName("li"),e.annrows=[],e.announcementScroll=function(){if(this.annstop)return this.annst=setTimeout(function(){e.announcementScroll()},this.anndelay),void 0;if(!this.annst){var t=-1;for(i=0;this.annlis.length>i;i++)t!=this.annlis[i].offsetTop&&(-1==t&&(t=0),this.annrows[this.annrowcount]=this.annlis[i].offsetTop-t,this.annrowcount++),t=this.annlis[i].offsetTop;return 1==this.annrows.length?$("an").onmouseover=$("an").onmouseout=null:(this.annrows[this.annrowcount]=this.annrows[1],$("ancl").innerHTML+=$("ancl").innerHTML,this.annst=setTimeout(function(){e.announcementScroll()},this.anndelay),$("an").onmouseover=function(){e.annstop=1},$("an").onmouseout=function(){e.annstop=0}),this.annrowcount=1,void 0}this.annrowcount>=this.annrows.length?($("anc").scrollTop=0,this.annrowcount=1,this.annst=setTimeout(function(){e.announcementScroll()},this.anndelay)):(this.anncount=0,this.announcementScrollnext(this.annrows[this.annrowcount]))},e.announcementScrollnext=function(t){$("anc").scrollTop++,this.anncount++,this.anncount!=t?this.annst=setTimeout(function(){e.announcementScrollnext(t)},10):(this.annrowcount++,this.annst=setTimeout(function(){e.announcementScroll()},this.anndelay))},e.announcementScroll()}function removeindexheats(){return confirm("بۇ تېمىنى قىزغىن تېمىلار قاتارىدىن چىقىرىۋىتەمسىز؟")}function showTypes(e,t){var i=$(e);if(!i)return!1;var n=i.className;t=isUndefined(t)?1:t;var a=2*i.getElementsByTagName("li")[0].offsetHeight,s=i.offsetHeight,r=["يېيىش","يېغىش"],o=["unfold","fold"];if(s>a){var l=document.createElement("li");l.className=o[t],l.innerHTML=r[t],i.insertBefore(l,i.firstChild),i.className=n+" cttp",t&&(i.style.height="auto"),l.onclick=function(){this.className==o[0]?(i.style.height="auto",this.className=o[1],this.innerHTML=r[1]):(i.style.height="",this.className=o[0],this.innerHTML=r[0])}}}function fastpostvalidate(e,t){if(postpt)return!1;if(postpt=1,setTimeout(function(){postpt=0},2e3),t=t?t:0,s="","function"==typeof fastpostvalidateextra){var i=fastpostvalidateextra();if(!i)return!1}return""==e.message.value||""==e.subject.value?(s="كەچۈرۈڭ، ماۋزۇ ياكى مەزمۇن كىرگۈزمىدىڭىز",e.message.focus()):mb_strlen(e.subject.value)>180&&(s="ماۋزۇ 80 ھەرپتىن ئېشىپ كەتتى",e.subject.focus()),!disablepostctrl&&(0!=postminchars&&postminchars>mb_strlen(e.message.value)||0!=postmaxchars&&mb_strlen(e.message.value)>postmaxchars)&&(s="يازمىڭىزنىڭ ئۇزۇنلىقى ئۆلچەمگە چۈشمەيدۇ。\n\nھازىرقى ئۇزۇنلۇقى: "+mb_strlen(e.message.value)+" "+"ھەپ\nسىستېما چېكى: "+postminchars+" ھەرپتىن "+postmaxchars+" ھەرپكىچە"),s?(showError(s),doane(),$("fastpostsubmit").disabled=!1,!1):($("fastpostsubmit").disabled=!0,e.message.value=e.message.value.replace(/([^>=\]"'\/]|^)((((https?|ftp):\/\/)|www\.)([\w\-]+\.)*[\w\-\u4e00-\u9fa5]+\.([\.a-zA-Z0-9]+|\u4E2D\u56FD|\u7F51\u7EDC|\u516C\u53F8)((\?|\/|:)+[\w\.\/=\?%\-&~`@':+!]*)+\.(jpg|gif|png|bmp))/gi,"$1[img]$2[/img]"),e.message.value=parseurl(e.message.value),t?!0:(ajaxpost("fastpostform","fastpostreturn","fastpostreturn","onerror",$("fastpostsubmit")),!1))}function updatefastpostattach(){ajaxget("forum.php?mod=ajax&action=attachlist&posttime="+$("posttime").value+(fid?"&fid="+fid:""),"attachlist"),$("attach_tblheader").style.display=""}function succeedhandle_fastnewpost(e){location.href=e}function errorhandle_fastnewpost(){$("fastpostsubmit").disabled=!1}function atarget(e){e.target=getcookie("atarget")>0?"_blank":""}function setatarget(e){$("atarget").className="y atarget_"+e,$("atarget").onclick=function(){setatarget(1==e?-1:1)},setcookie("atarget",e,2592e3)}function loadData(quiet,formobj){var evalevent=function(obj){var script=obj.parentNode.innerHTML,re=/onclick="(.+?)["|>]/gi,matches=re.exec(script);null!=matches&&(matches[1]=matches[1].replace(/this\./gi,"obj."),eval(matches[1]))},data="";data=loadUserdata("forum_"+discuz_uid);var formobj=formobj?formobj:$("postform");if(in_array(data=trim(data),["","null","false",null,!1]))return quiet||showDialog("ئەسلىگە كەلتۈرگىلى بولىدىغان مەزمۇن يوق","info"),void 0;if(quiet||confirm("بۇ مەشغۇلات ھازىرقى يازمىنى باستۇرىۋىتىدۇ؟ ئەسلىگە قايتۇرامسىز؟")){for(var data=data.split(/\x09\x09/),i=0;formobj.elements.length>i;i++){var el=formobj.elements[i];if(""!=el.name&&("SELECT"==el.tagName||"TEXTAREA"==el.tagName||"INPUT"==el.tagName&&("text"==el.type||"checkbox"==el.type||"radio"==el.type||"hidden"==el.type)))for(var j=0;data.length>j;j++){var ele=data[j].split(/\x09/);if(ele[0]==el.name){if(elvalue=isUndefined(ele[3])?"":ele[3],"INPUT"==ele[1])if("text"==ele[2])el.value=elvalue;else if("checkbox"!=ele[2]&&"radio"!=ele[2]||ele[3]!=el.value){if("hidden"==ele[2]&&(eval("var check = typeof "+el.id+"_upload == 'function'"),check)){var v=elvalue.split(/\x01/);if(el.value=v[0],el.value&&($(el.id+"_url")&&v[1]&&($(el.id+"_url").value=v[1]),eval(el.id+"_upload('"+v[0]+"', '"+v[1]+"')"),$("unused"+v[0]))){var attachtype=$("unused"+v[0]).parentNode.parentNode.parentNode.parentNode.id.substr(11);$("unused"+v[0]).parentNode.parentNode.outerHTML="",$("unusednum_"+attachtype).innerHTML=parseInt($("unusednum_"+attachtype).innerHTML)-1,0==$("unusednum_"+attachtype).innerHTML&&$("attachnotice_"+attachtype)&&($("attachnotice_"+attachtype).style.display="none")}}}else el.checked=!0,evalevent(el);else if("TEXTAREA"==ele[1])"message"==ele[0]?wysiwyg?editdoc.body.innerHTML=bbcode2html(elvalue):textobj.value=elvalue:el.value=elvalue;else if("SELECT"==ele[1])if($(el.id+"_ctrl_menu")){for(var lis=$(el.id+"_ctrl_menu").getElementsByTagName("li"),k=0;lis.length>k;k++)if(ele[3]==lis[k].k_value){lis[k].onclick();break}}else for(var k=0;el.options.length>k;k++)if(ele[3]==el.options[k].value){el.options[k].selected=!0;break}break}}}$("rstnotice")&&($("rstnotice").style.display="none"),extraCheckall()}}function checkForumnew(e,t){var i=checkForumtimeout,n=new Ajax;n.get("forum.php?mod=ajax&action=forumchecknew&fid="+e+"&time="+t+"&inajax=yes",function(n){if(n>0){var a=$("separatorline").parentNode;isUndefined(checkForumnew_handle)||clearTimeout(checkForumnew_handle),removetbodyrow(a,"forumnewshow");var s=a.getElementsByTagName("tbody")[0].rows[0].children.length,r={tid:"",thread:{common:{className:"",val:'<a href="javascript:void(0);" onclick="ajaxget(\'forum.php?mod=ajax&action=forumchecknew&fid='+e+"&time="+t+"&uncheck=1&inajax=yes', 'forumnew');\">يېڭى ئىنكاسلىق تېما بار، بۇ يەرنى چېكىپ كۆرۈڭ",colspan:s}}};addtbodyrow(a,["tbody"],["forumnewshow"],"separatorline",r)}else if(50>checkForumcount){if(checkForumcount>0){var o=Math.ceil(50/checkForumcount);5>o&&(i=checkForumtimeout*(5-o+1))}checkForumnew_handle=setTimeout(function(){checkForumnew(e,t)},i)}checkForumcount++})}function checkForumnew_btn(e){isUndefined(e)||(ajaxget("forum.php?mod=ajax&action=forumchecknew&fid="+e+"&time="+lasttime+"&uncheck=2&inajax=yes","forumnew","ajaxwaitid"),lasttime=parseInt(Date.parse(new Date)/1e3))}function addtbodyrow(e,t,i,n,a){if(!isUndefined(e)&&!isUndefined(t[0])){var s=document.createElement(t[0]),r=a.thread,o=isUndefined(a.tid)?"":a.tid;isUndefined(i[1])||removetbodyrow(e,i[1]+o),s.id=i[0]+o,isUndefined(t[1])||(s.className=t[1]),$(n)?e.insertBefore(s,$(n).nextSibling):e.insertBefore(s,e.firstChild);var l=s.insertRow(-1);for(var c in r)if(0!=c){var d=l.insertCell(-1);d.innerHTML=isUndefined(r[c].val)?r[c]:r[c].val,isUndefined(r[c].className)||(d.className=r[c].className),isUndefined(r[c].colspan)||(d.colSpan=r[c].colspan)}isUndefined(t[2])||_attachEvent(s,t[2],function(){s.className=""})}}function removetbodyrow(e,t){!isUndefined(e)&&$(t)&&e.removeChild($(t))}function leftside(e){$(e).className="a"==$(e).className?"":"a","lf_fav"==e&&setcookie("leftsidefav","a"==$(e).className?0:1,2592e3)}var postpt=0,checkForumcount=0,checkForumtimeout=3e4,checkForumnew_handle;